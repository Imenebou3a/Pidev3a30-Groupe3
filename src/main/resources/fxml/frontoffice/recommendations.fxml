<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="tn.esprit.controllers.frontoffice.RecommendationsFrontController"
            stylesheets="@../../css/recommendations.css">

    <!-- HEADER -->
    <top>
        <VBox styleClass="header-container">
            <HBox alignment="CENTER_LEFT" spacing="15" styleClass="header-box">
                <Label text="âœ¨ Recommandations pour vous" styleClass="header-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="PropulsÃ© par IA" styleClass="ai-badge"/>
                <Button text="ðŸ”„ Actualiser" onAction="#actualiserRecommandations" styleClass="btn-refresh"/>
            </HBox>
            
            <!-- SOUS-TITRE -->
            <Label text="BasÃ© sur vos favoris et prÃ©fÃ©rences" styleClass="header-subtitle">
                <padding>
                    <Insets top="5" left="20"/>
                </padding>
            </Label>
        </VBox>
    </top>

    <!-- CONTENT -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="scroll-pane">
            <VBox spacing="25" styleClass="content-container">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <!-- OPTIONS -->
                <HBox spacing="15" alignment="CENTER_LEFT" styleClass="options-box">
                    <Label text="Nombre de recommandations:" styleClass="option-label"/>
                    <ComboBox fx:id="comboNombre" value="10" styleClass="option-combo">
                        <items>
                            <javafx.collections.FXCollections fx:factory="observableArrayList">
                                <java.lang.String fx:value="5"/>
                                <java.lang.String fx:value="10"/>
                                <java.lang.String fx:value="15"/>
                                <java.lang.String fx:value="20"/>
                            </javafx.collections.FXCollections>
                        </items>
                    </ComboBox>
                    
                    <Separator orientation="VERTICAL"/>
                    
                    <CheckBox fx:id="checkIA" text="Utiliser l'IA OpenAI" selected="false" 
                              styleClass="check-ia"/>
                    <Label text="(Plus intelligent mais plus lent)" styleClass="check-hint"/>
                    
                    <Region HBox.hgrow="ALWAYS"/>
                    
                    <Button text="ðŸŽ¯ GÃ©nÃ©rer" onAction="#genererRecommandations" 
                            styleClass="btn-generate"/>
                </HBox>

                <!-- LOADING -->
                <VBox fx:id="boxLoading" alignment="CENTER" spacing="15" styleClass="loading-box" 
                      visible="false" managed="false">
                    <ProgressIndicator styleClass="loading-spinner"/>
                    <Label text="GÃ©nÃ©ration des recommandations en cours..." styleClass="loading-text"/>
                    <Label fx:id="lblLoadingDetail" text="Analyse de vos prÃ©fÃ©rences..." 
                           styleClass="loading-detail"/>
                </VBox>

                <!-- MESSAGE SI VIDE -->
                <VBox fx:id="boxVide" alignment="CENTER" spacing="15" styleClass="empty-box" 
                      visible="false" managed="false">
                    <Label text="ðŸŽ¯" styleClass="empty-icon"/>
                    <Label text="Aucune recommandation disponible" styleClass="empty-text"/>
                    <Label text="Ajoutez des produits Ã  vos favoris pour recevoir des recommandations personnalisÃ©es" 
                           styleClass="empty-subtext" wrapText="true" maxWidth="450"/>
                    <Button text="â¤ï¸ Voir mes favoris" onAction="#allerFavoris" 
                            styleClass="btn-discover"/>
                </VBox>

                <!-- STATISTIQUES -->
                <HBox fx:id="boxStats" spacing="20" alignment="CENTER" styleClass="stats-box" 
                      visible="false" managed="false">
                    <VBox alignment="CENTER" spacing="5" styleClass="stat-item">
                        <Label fx:id="lblNbRecommandations" text="0" styleClass="stat-number"/>
                        <Label text="Recommandations" styleClass="stat-label"/>
                    </VBox>
                    
                    <Separator orientation="VERTICAL"/>
                    
                    <VBox alignment="CENTER" spacing="5" styleClass="stat-item">
                        <Label fx:id="lblScoreMoyen" text="0%" styleClass="stat-number"/>
                        <Label text="Score moyen" styleClass="stat-label"/>
                    </VBox>
                    
                    <Separator orientation="VERTICAL"/>
                    
                    <VBox alignment="CENTER" spacing="5" styleClass="stat-item">
                        <Label fx:id="lblTempsGeneration" text="0s" styleClass="stat-number"/>
                        <Label text="Temps de gÃ©nÃ©ration" styleClass="stat-label"/>
                    </VBox>
                </HBox>

                <!-- GRILLE DE RECOMMANDATIONS -->
                <FlowPane fx:id="gridRecommandations" hgap="20" vgap="20" styleClass="recommendations-grid">
                    <!-- Les cartes de recommandations seront ajoutÃ©es dynamiquement -->
                </FlowPane>

            </VBox>
        </ScrollPane>
    </center>

    <!-- FOOTER -->
    <bottom>
        <HBox alignment="CENTER" spacing="20" styleClass="footer-box">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <Label fx:id="lblMessage" text="" styleClass="footer-message" visible="false"/>
        </HBox>
    </bottom>

</BorderPane>
